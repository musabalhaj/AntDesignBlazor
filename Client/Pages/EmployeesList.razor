@page "/employees"
@inject IEmployeeService EmployeeService
@inject ModalService _modalService

<div class="mb-2">
    <Breadcrumb>
        <BreadcrumbItem Href="/">Home</BreadcrumbItem>
        <BreadcrumbItem>Employees</BreadcrumbItem>
    </Breadcrumb>
</div>
<hr />
<a class="btn btn-info btn-sm btn-flat mb-2 pull-right" href="createemployee">
    <i class="oi oi-plus"></i> New Employee
</a>


<Card Hoverable Title="Employees List">

    <Table DataSource="Employees" PageSize="10" Class="table table-responsive" Loading="_loading">
        <Column @bind-Field="@context.FirstName" Sortable></Column>
        <Column @bind-Field="@context.LastName"></Column>
        <Column @bind-Field="@context.Email"></Column>
        <Column @bind-Field="@context.Gender"></Column>
        <Column @bind-Field="@context.DepartmentId">@context.Department.DepartmentName</Column>
        <Column @bind-Field="@context.DateOfBirth" Format="dd/MM/yyy"></Column>
        <ActionColumn Title="Action">
            <Space>
                <SpaceItem>
                    <a class="btn btn-info btn-sm btn-flat m-1" href="@($"displayemployee/{context.EmployeeId}")">
                        <i class="oi oi-eye"></i>
                    </a>
                    <a class="btn btn-success btn-sm btn-flat m-1" href="@($"editemployee/{context.EmployeeId}")">
                        <i class="oi oi-pencil"></i>
                    </a>
                    <Button Danger OnClick="@(()=>{ _visible = true; _Id = context.EmployeeId; })">
                        <i class="oi oi-trash"></i>
                    </Button>
                </SpaceItem>
            </Space>
        </ActionColumn>
    </Table>

</Card>


<Modal Title="@_title"
       Visible="@_visible"
       OnOk="@HandleOk"
       OnCancel="@HandleCancel"
       DestroyOnClose="true"
       OkType="danger">
    Do you want to Delete This Employee?
</Modal>

@code{
    bool _loading;
    public List<Employee> Employees { get; set; } = new List<Employee>();

    protected override async Task OnInitializedAsync()
    {
        _loading = true;
        Employees = (await EmployeeService.GetEmployees()).ToList();
        _loading = false;
    }

    string _title = "Delete Confirmation";
    bool _visible = false;
    int _Id;

    private async Task HandleOk(MouseEventArgs e)
    {
        await EmployeeService.DeleteEmployee(_Id);
        Employees = (await EmployeeService.GetEmployees()).ToList();
        _visible = false;
        HandleSuccess();
    }

    private void HandleCancel(MouseEventArgs e)
    {
        _visible = false;
    }

    private void HandleSuccess()
    {
        _modalService.Success(new ConfirmOptions()
        {
            Content = "Employee Deleted Successfully."
        });
    }

}
