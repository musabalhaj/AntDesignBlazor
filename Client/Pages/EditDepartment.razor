@page "/editdepartment/{id:int}"
@inject IDepartmentVeiwModel DepartmentVeiwModel
<div class="mb-2">
    <Breadcrumb>
        <BreadcrumbItem Href="/">Home</BreadcrumbItem>
        <BreadcrumbItem Href="/departments">Departments</BreadcrumbItem>
        <BreadcrumbItem>Edit</BreadcrumbItem>
    </Breadcrumb>
</div>
<hr />

<Card Hoverable Title="Edit Department" Loading="_loading">
    <Form Model="@Department"
          OnFinish="HamdleValidSubmit"
          Layout="vertical">
        <ValidationSummary />
        <FormItem Label="Department Name">
            <Input @bind-Value="@context.DepartmentName" />
        </FormItem>
        <FormItem>
            <Button Type="@ButtonType.Primary" HtmlType="submit">
                Update
            </Button>
        </FormItem>
    </Form>
</Card>

@code{
    [CascadingParameter]
    public Error Error { get; set; }

    [Parameter]
    public int Id { get; set; }
    public Department Department { get; set; } = new Department();
    bool _loading;

    protected async override Task OnInitializedAsync()
    {
        try
        {
            _loading = true;
            Department = await DepartmentVeiwModel.GetDepartment(Id);
            _loading = false;
        }
        catch (Exception ex)
        {

            Error.ProcessError(ex);
        }

    }

    protected async Task HamdleValidSubmit()
    {
        try
        {
            var result = await DepartmentVeiwModel.UpdateDepartment(Department);
            if (result != null)
            {
                DepartmentVeiwModel.HandleSuccessUpdate();
            }
        }
        catch (Exception ex)
        {

            Error.ProcessError(ex);
        }

    }
}
